---
# lego_acme-client/tasks/main.yml

- name: 'Download binary on Debian'
  ansible.builtin.include_tasks: download_binary_on_Debian.yml
  tags:
    - 'installation'
  when:
    - 'ansible_distribution == "Debian"'

- name: 'Create helper script'
  ansible.builtin.include_tasks: create_helper_script.yml
  tags:
    - 'helper_script'

- name: 'Create config file'
  ansible.builtin.include_tasks: create_config_file.yml
  tags:
    - 'config_file'
  when:
    - 'create_lego_config_file | bool'

- name: 'Create systemd timer for certificate renewal'
  ansible.builtin.include_tasks: systemd_timer.yml
  tags:
    - 'systemd_timer'

- name: 'Enable and start the systemd timer for certificate renewal'
  ansible.builtin.service:
    name: 'lego_certificate_renew.timer'
    state: 'started'
    enabled: 'true'
  tags:
    - 'systemd_timer'
  when:
    - 'enable_lego_renew_timer | bool'
